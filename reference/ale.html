<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Accumulated Local Effects (ALE) — ale • effectplots</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Accumulated Local Effects (ALE) — ale"><meta property="og:description" content="Calculates ALE for one or multiple X variables.
The concept of ALE was introduced in Apley et al. (2020) as an alternative to
partial dependence (PD). The Ceteris Paribus clause behind PD is a blessing and
a curse at the same time:
Blessing: The interpretation is easy and similar to what we know from linear
regression  (just averaging out interaction effects).
Curse: The model is applied to very unlikely or even impossible feature
combinations, especially with strongly dependent features.


ALE fixes the curse as follows: Partial dependence is calculated for the lower and
upper endpoint of a bin, using all (or a sample) of observations falling into this
bin. Its slope provides the local effect over the bin.
This is repeated for all bins, and the values are accumulated. Since the resulting
sum starts at 0, one typically shifts the result vertically, e.g., to the average
prediction. This is not done by ale(), however.
The function is a convenience wrapper around feature_effects(), which calls
the barebone implementation .ale() to calculate ALE. The ALE values calculated
by feature_effects() are vertically shifted to the same (weighted) average than the
partial dependence curve, for optimal comparability."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">effectplots</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/mayer79/effectplots/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Accumulated Local Effects (ALE)</h1>
    <small class="dont-index">Source: <a href="https://github.com/mayer79/effectplots/blob/0.1.0/R/ale.R" class="external-link"><code>R/ale.R</code></a></small>
    <div class="hidden name"><code>ale.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Calculates ALE for one or multiple <code>X</code> variables.</p>
<p>The concept of ALE was introduced in Apley et al. (2020) as an alternative to
partial dependence (PD). The Ceteris Paribus clause behind PD is a blessing and
a curse at the same time:</p><ul><li><p>Blessing: The interpretation is easy and similar to what we know from linear
regression  (just averaging out interaction effects).</p></li>
<li><p>Curse: The model is applied to very unlikely or even impossible feature
combinations, especially with strongly dependent features.</p></li>
</ul><p>ALE fixes the curse as follows: Partial dependence is calculated for the lower and
upper endpoint of a bin, using all (or a sample) of observations falling into this
bin. Its slope provides the <em>local effect</em> over the bin.
This is repeated for all bins, and the values are <em>accumulated</em>. Since the resulting
sum starts at 0, one typically shifts the result vertically, e.g., to the average
prediction. This is not done by <code>ale()</code>, however.</p>
<p>The function is a convenience wrapper around <code><a href="feature_effects.html">feature_effects()</a></code>, which calls
the barebone implementation <code><a href="dot-ale.html">.ale()</a></code> to calculate ALE. The ALE values calculated
by <code><a href="feature_effects.html">feature_effects()</a></code> are vertically shifted to the same (weighted) average than the
partial dependence curve, for optimal comparability.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ale</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">ale</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">v</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  pred_fun <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span>,</span>
<span>  trafo <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  which_pred <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  w <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  breaks <span class="op">=</span> <span class="st">"Sturges"</span>,</span>
<span>  right <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  discrete_m <span class="op">=</span> <span class="fl">5L</span>,</span>
<span>  outlier_iqr <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  ale_n <span class="op">=</span> <span class="fl">50000L</span>,</span>
<span>  ale_bin_size <span class="op">=</span> <span class="fl">200L</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'ranger'</span></span>
<span><span class="fu">ale</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">v</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  pred_fun <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  trafo <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  which_pred <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  w <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  breaks <span class="op">=</span> <span class="st">"Sturges"</span>,</span>
<span>  right <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  discrete_m <span class="op">=</span> <span class="fl">5L</span>,</span>
<span>  outlier_iqr <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  ale_n <span class="op">=</span> <span class="fl">50000L</span>,</span>
<span>  ale_bin_size <span class="op">=</span> <span class="fl">200L</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'explainer'</span></span>
<span><span class="fu">ale</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">object</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  pred_fun <span class="op">=</span> <span class="va">object</span><span class="op">$</span><span class="va">predict_function</span>,</span>
<span>  trafo <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  which_pred <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  w <span class="op">=</span> <span class="va">object</span><span class="op">$</span><span class="va">weights</span>,</span>
<span>  breaks <span class="op">=</span> <span class="st">"Sturges"</span>,</span>
<span>  right <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  discrete_m <span class="op">=</span> <span class="fl">5L</span>,</span>
<span>  outlier_iqr <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  ale_n <span class="op">=</span> <span class="fl">50000L</span>,</span>
<span>  ale_bin_size <span class="op">=</span> <span class="fl">200L</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>Fitted model.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Further arguments passed to <code>pred_fun()</code>, e.g., <code>type = "response"</code> in
a <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code> or (typically) <code>prob = TRUE</code> in classification models.</p></dd>


<dt id="arg-v">v<a class="anchor" aria-label="anchor" href="#arg-v"></a></dt>
<dd><p>Vector of variable names to calculate statistics.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Matrix or data.frame.</p></dd>


<dt id="arg-pred-fun">pred_fun<a class="anchor" aria-label="anchor" href="#arg-pred-fun"></a></dt>
<dd><p>Prediction function, by default <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">stats::predict</a></code>.
The function takes three arguments (names irrelevant): <code>object</code>, <code>data</code>, and <code>...</code>.</p></dd>


<dt id="arg-trafo">trafo<a class="anchor" aria-label="anchor" href="#arg-trafo"></a></dt>
<dd><p>How should predictions be transformed?
A function or <code>NULL</code> (default). Examples are <code>log</code> (to switch to link scale)
or <code>exp</code> (to switch from link scale to the original scale).</p></dd>


<dt id="arg-which-pred">which_pred<a class="anchor" aria-label="anchor" href="#arg-which-pred"></a></dt>
<dd><p>If the predictions are multivariate: which column to pick
(integer or column name). By default <code>NULL</code> (picks last column).</p></dd>


<dt id="arg-w">w<a class="anchor" aria-label="anchor" href="#arg-w"></a></dt>
<dd><p>Optional vector with case weights. Can also be a column name in <code>data</code>.</p></dd>


<dt id="arg-breaks">breaks<a class="anchor" aria-label="anchor" href="#arg-breaks"></a></dt>
<dd><p>An integer, vector, string or function specifying the bins
of the numeric X variables as in <code><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">graphics::hist()</a></code>. The default is "Sturges".
To allow varying values of <code>breaks</code> across variables, it can be a list of the
same length as <code>v</code>, or a <em>named</em> list with <code>breaks</code> for certain variables.</p></dd>


<dt id="arg-right">right<a class="anchor" aria-label="anchor" href="#arg-right"></a></dt>
<dd><p>Should bins be right-closed? The default is <code>TRUE</code>.
Vectorized over <code>v</code>. Only relevant for numeric X.</p></dd>


<dt id="arg-discrete-m">discrete_m<a class="anchor" aria-label="anchor" href="#arg-discrete-m"></a></dt>
<dd><p>Numeric X variables with up to this number of unique values
should not be binned and treated as a factor (after calculating partial dependence)
The default is 5. Vectorized over <code>v</code>.</p></dd>


<dt id="arg-outlier-iqr">outlier_iqr<a class="anchor" aria-label="anchor" href="#arg-outlier-iqr"></a></dt>
<dd><p>Outliers of a numeric X are capped via the boxplot rule, i.e.,
outside <code>outlier_iqr</code> * IQR from the quartiles. The default is 2 is more
conservative than the usual rule to account for right-skewed distributions.
Set to 0 or <code>Inf</code> for no capping. Note that at most 10k observations are sampled
to calculate quartiles. Vectorized over <code>v</code>.</p></dd>


<dt id="arg-ale-n">ale_n<a class="anchor" aria-label="anchor" href="#arg-ale-n"></a></dt>
<dd><p>Size of the data used for calculating ALE.
The default is 50000. For larger <code>data</code> (and <code>w</code>), <code>ale_n</code> rows are randomly
sampled. Each variable specified by <code>v</code> uses the same subsample. Set to 0 to omit.</p></dd>


<dt id="arg-ale-bin-size">ale_bin_size<a class="anchor" aria-label="anchor" href="#arg-ale-bin-size"></a></dt>
<dd><p>Maximal number of observations used per bin for ALE calculations.
If there are more observations in a bin, <code>ale_bin_size</code> indices are
randomly sampled. The default is 200. Applied after subsampling regarding <code>ale_n</code>.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Optional random seed (an integer) used for:</p><ul><li><p>ALE: select background data if <code>n &gt; ale_n</code> and for bins &gt; <code>ale_bin_size</code>.</p></li>
<li><p>Capping X: quartiles are selected based on 10k observations.</p></li>
</ul></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A list (of class "EffectData") with a data.frame of statistics per feature. Use
single bracket subsetting to select part of the output.</p>
    </div>
    <div id="methods-by-class-">
    <h2>Methods (by class)</h2>

<ul><li><p><code>ale(default)</code>: Default method.</p></li>
<li><p><code>ale(ranger)</code>: Default method.</p></li>
<li><p><code>ale(explainer)</code>: Default method.</p></li>
</ul></div>
    <div id="references">
    <h2>References</h2>
    <p>Apley, Daniel W., and Jingyu Zhu. 2020. <em>Visualizing the Effects of Predictor Variables in Black Box Supervised Learning Models.</em>
Journal of the Royal Statistical Society Series B: Statistical Methodology,
82 (4): 1059–1086. doi:10.1111/rssb.12377.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="feature_effects.html">feature_effects()</a></code>, <code><a href="dot-ale.html">.ale()</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Sepal.Length</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu">ale</span><span class="op">(</span><span class="va">fit</span>, v <span class="op">=</span> <span class="st">"Petal.Length"</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">M</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ale-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">M2</span> <span class="op">&lt;-</span> <span class="fu">ale</span><span class="op">(</span><span class="va">fit</span>, v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, data <span class="op">=</span> <span class="va">iris</span>, breaks <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Dropping variables without results: Species</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M2</span>, share_y <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span>  <span class="co"># Only numeric variables shown</span></span></span>
<span class="r-plt img"><img src="ale-2.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Michael Mayer.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

